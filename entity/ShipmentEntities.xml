<?xml version="1.0" encoding="UTF-8"?>
<!--
This software is in the public domain under CC0 1.0 Universal plus a 
Grant of Patent License.

To the extent possible under law, the author(s) have dedicated all
copyright and related and neighboring rights to this software to the
public domain worldwide. This software is distributed without any
warranty.

You should have received a copy of the CC0 Public Domain Dedication
along with this software (see the LICENSE.md file). If not, see
<http://creativecommons.org/publicdomain/zero/1.0/>.
-->
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/entity-definition-2.1.xsd">
    <!-- ========================================================= -->
    <!--  - mantle.shipment -->
    <!--  - mantle.shipment.carrier -->
    <!-- ========================================================= -->


    <!-- ========================================================= -->
    <!-- mantle.shipment -->
    <!-- ========================================================= -->

    <entity entity-name="Shipment" package="mantle.shipment" short-alias="shipments" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="shipmentTypeEnumId" type="id"/>
        <field name="statusId" type="id" enable-audit-log="true"/>

        <field name="fromPartyId" type="id" enable-audit-log="update"/>
        <field name="toPartyId" type="id" enable-audit-log="update"/>
        <field name="binLocationNumber" type="number-integer"><description>For picking multiple shipments in a single
            shipment load (WorkEffort with purpose Shipment Load/Ship, WepShipmentShip); this is the structure for a
            picklist instead of having a separate Picklist entity. This may be overridden within a Shipment with the
            field of the same name on ShipmentItemSource.</description></field>

        <field name="entryDate" type="date-time"/>
        <field name="shipAfterDate" type="date-time" enable-audit-log="update"/>
        <field name="shipBeforeDate" type="date-time" enable-audit-log="update"/>
        <field name="estimatedReadyDate" type="date-time" enable-audit-log="update"/>
        <field name="estimatedShipDate" type="date-time" enable-audit-log="update"/>
        <field name="estimatedArrivalDate" type="date-time" enable-audit-log="update"/>
        <field name="latestCancelDate" type="date-time"/>
        <field name="packedDate" type="date-time"/>

        <field name="shipWorkEffortId" type="id" enable-audit-log="update"/>
        <field name="receiveWorkEffortId" type="id"/>

        <field name="estimatedShipCost" type="currency-amount"/>
        <field name="costUomId" type="id"/>
        <field name="addtlShippingCharge" type="currency-amount"/>
        <field name="addtlShippingChargeDesc" type="text-medium"/>

        <field name="signatureRequiredEnumId" type="id"/>
        <field name="handlingInstructions" type="text-long"/>
        <field name="otherPartyOrderId" type="text-short"/>
        <field name="systemMessageRemoteId" type="id"/>
        <field name="externalId" type="text-short"><description>ID for the shipment in the direct upstream system it came from if it came from an external system</description></field>
        <field name="originId" type="text-short"><description>ID for the shipment in the original system it came from if not the direct upstream system</description></field>

        <relationship type="one" title="ShipmentType" related="moqui.basic.Enumeration" short-alias="type">
            <key-map field-name="shipmentTypeEnumId"/></relationship>
        <relationship type="one" title="Shipment" related="moqui.basic.StatusItem" short-alias="status"/>
        <relationship type="one" title="From" related="mantle.party.Party" short-alias="fromParty">
            <key-map field-name="fromPartyId"/></relationship>
        <relationship type="one" title="To" related="mantle.party.Party" short-alias="toParty">
            <key-map field-name="toPartyId"/></relationship>

        <relationship type="one" title="Ship" related="mantle.work.effort.WorkEffort" short-alias="shipWorkEffort">
            <key-map field-name="shipWorkEffortId"/></relationship>
        <relationship type="one" title="Receive" related="mantle.work.effort.WorkEffort" short-alias="receiveWorkEffort">
            <key-map field-name="receiveWorkEffortId"/></relationship>
        <relationship type="one" title="Cost" related="moqui.basic.Uom" short-alias="costUom">
            <key-map field-name="costUomId"/></relationship>
        <relationship type="one" title="SignatureRequired" related="moqui.basic.Enumeration" short-alias="signatureRequiredEnum">
            <key-map field-name="signatureRequiredEnumId"/></relationship>
        <relationship type="one" related="moqui.service.message.SystemMessageRemote"/>

        <relationship type="many" related="mantle.shipment.ShipmentContent" short-alias="contents">
            <key-map field-name="shipmentId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentItem" short-alias="items">
            <key-map field-name="shipmentId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentItemSource" short-alias="itemSources">
            <key-map field-name="shipmentId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentPackage" short-alias="packages">
            <key-map field-name="shipmentId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentRouteSegment" short-alias="routeSegments">
            <key-map field-name="shipmentId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentPackageRouteSeg" short-alias="packageRouteSegments">
            <key-map field-name="shipmentId"/></relationship>

        <seed-data>
            <!-- Shipment Type -->
            <moqui.basic.EnumerationType description="Shipment Type" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Incoming" enumId="ShpTpIncoming" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Outgoing" enumId="ShpTpOutgoing" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Sales Return" parentEnumId="ShpTpIncoming" enumId="ShpTpSalesReturn" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Sales Shipment" parentEnumId="ShpTpOutgoing" enumId="ShpTpSales" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Purchase Shipment" parentEnumId="ShpTpIncoming" enumId="ShpTpPurchase" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Purchase Return" parentEnumId="ShpTpOutgoing" enumId="ShpTpPurchaseReturn" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Drop Shipment" enumId="ShpTpDrop" enumTypeId="ShipmentType"/>
            <moqui.basic.Enumeration description="Transfer" enumId="ShpTpTransfer" enumTypeId="ShipmentType"/>

            <!-- Shipment Status -->
            <moqui.basic.StatusType description="Shipment Status" statusTypeId="Shipment"/>
            <moqui.basic.StatusItem description="Input" sequenceNum="1" statusId="ShipInput" statusTypeId="Shipment"/>
            <moqui.basic.StatusItem description="Scheduled" sequenceNum="2" statusId="ShipScheduled" statusTypeId="Shipment"/>
            <moqui.basic.StatusItem description="Picked" sequenceNum="3" statusId="ShipPicked" statusTypeId="Shipment"/>
            <moqui.basic.StatusItem description="Packed" sequenceNum="4" statusId="ShipPacked" statusTypeId="Shipment"/>
            <moqui.basic.StatusItem description="Shipped" sequenceNum="5" statusId="ShipShipped" statusTypeId="Shipment"/>
            <moqui.basic.StatusItem description="Delivered" sequenceNum="6" statusId="ShipDelivered" statusTypeId="Shipment"/>
            <moqui.basic.StatusItem description="Rejected" sequenceNum="98" statusId="ShipRejected" statusTypeId="Shipment"/><!-- Rejected by receiver -->
            <moqui.basic.StatusItem description="Cancelled" sequenceNum="99" statusId="ShipCancelled" statusTypeId="Shipment"/><!-- Cancelled by sender -->
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipInput" toStatusId="ShipScheduled" transitionName="Schedule"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipInput" toStatusId="ShipPicked" transitionName="Pick"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipInput" toStatusId="ShipPacked" transitionName="Pack"/>
            <!-- NOTE: this allows skipping the Packed status but that should never be done for outgoing orders or invoice/posting/etc won't be done -->
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipInput" toStatusId="ShipShipped" transitionName="Ship"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipInput" toStatusId="ShipDelivered" transitionName="Deliver"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipInput" toStatusId="ShipCancelled" transitionName="Cancel"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipScheduled" toStatusId="ShipPicked" transitionName="Pick"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipScheduled" toStatusId="ShipPacked" transitionName="Pack"/>
            <!-- only for incoming shipments, outgoing shipments must always go through Packed -->
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipScheduled" toStatusId="ShipShipped" transitionName="Ship"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipScheduled" toStatusId="ShipDelivered" transitionName="Deliver"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipScheduled" toStatusId="ShipCancelled" transitionName="Cancel"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipPicked" toStatusId="ShipPacked" transitionName="Pack"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipPicked" toStatusId="ShipCancelled" transitionName="Cancel"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipPacked" toStatusId="ShipShipped" transitionName="Ship"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipPacked" toStatusId="ShipDelivered" transitionName="Deliver"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipPacked" toStatusId="ShipRejected" transitionName="Reject"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipPacked" toStatusId="ShipCancelled" transitionName="Cancel"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipShipped" toStatusId="ShipDelivered" transitionName="Deliver"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipShipped" toStatusId="ShipRejected" transitionName="Reject"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipShipped" toStatusId="ShipCancelled" transitionName="Cancel"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipDelivered" toStatusId="ShipShipped" transitionName="Un-deliver"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShipShipped" toStatusId="ShipPacked" transitionName="Un-ship"/>

            <!-- Signature Required - see data in PartyEntities.xml under PartySettingType, there for FK dependency -->
        </seed-data>
        <master>
            <detail relationship="type"/>
            <detail relationship="status"/>
            <detail relationship="fromParty" use-master="basic"/>
            <detail relationship="toParty" use-master="basic"/>
            <detail relationship="shipWorkEffort"/>
            <detail relationship="receiveWorkEffort"/>
            <detail relationship="costUom"/>
            <detail relationship="contents"/>
            <detail relationship="items">
                <detail relationship="sources"><detail relationship="status"/></detail>
                <detail relationship="contents"/>
                <detail relationship="issuances"/>
                <detail relationship="receipts"/>
            </detail>
            <detail relationship="packages">
                <detail relationship="contents"/>
                <detail relationship="routeSegments"/>
            </detail>
            <detail relationship="routeSegments">
                <detail relationship="carrierParty" use-master="basic"/>
                <detail relationship="shipmentMethod"/>
                <detail relationship="originFacility"/>
                <detail relationship="originPostal" use-master="default"/>
                <detail relationship="originTelecom" use-master="default"/>
                <detail relationship="destFacility"/>
                <detail relationship="destPostal" use-master="default"/>
                <detail relationship="destTelecom" use-master="default"/>
                <detail relationship="status"/>
                <detail relationship="costUom"/>
                <detail relationship="billingWeightUom"/>
            </detail>
        </master>
    </entity>
    <extend-entity entity-name="SystemMessage" package="moqui.service.message">
        <field name="shipmentId" type="id"/>
        <relationship type="one" related="mantle.shipment.Shipment" short-alias="shipment"/>
    </extend-entity>
    <entity entity-name="ShipmentSystemMessage" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="systemMessageId" type="id" is-pk="true"/>
        <field name="externalId" type="text-short"/>
        <field name="originId" type="text-short"/>
        <relationship type="one" related="mantle.shipment.Shipment"/>
        <relationship type="one" related="moqui.service.message.SystemMessage"/>
    </entity>

    <entity entity-name="ShipmentBoxType" package="mantle.shipment" cache="true">
        <field name="shipmentBoxTypeId" type="id" is-pk="true"/>
        <field name="pseudoId" type="id" default="shipmentBoxTypeId"/>
        <field name="description" type="text-medium"/>
        <field name="dimensionUomId" type="id"/>
        <field name="boxLength" type="number-decimal"/>
        <field name="boxWidth" type="number-decimal"/>
        <field name="boxHeight" type="number-decimal"/>
        <field name="weightUomId" type="id"/>
        <field name="boxWeight" type="number-decimal"/>
        <field name="defaultGrossWeight" type="number-decimal">
            <description>For flat rate boxes up to a certain weight, used if there is no ShipmentPackage.weight</description></field>
        <field name="capacityUomId" type="id"/>
        <field name="boxCapacity" type="number-decimal"/>
        <field name="gatewayBoxId" type="text-medium"/>
        <relationship type="one" title="Dimension" related="moqui.basic.Uom" short-alias="dimensionUom">
            <key-map field-name="dimensionUomId"/></relationship>
        <relationship type="one" title="Weight" related="moqui.basic.Uom" short-alias="weightUom">
            <key-map field-name="weightUomId"/></relationship>
        <relationship type="one" title="Capacity" related="moqui.basic.Uom" short-alias="capacityUom">
            <key-map field-name="capacityUomId"/></relationship>
        <index name="SH_BOX_TYPE_PSEUDO" unique="true"><index-field name="pseudoId"/></index>
    </entity>
    <entity entity-name="ShipmentContactMech" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="contactMechPurposeId" type="id" is-pk="true"/>
        <field name="contactMechId" type="id"/>
        <relationship type="one" related="mantle.shipment.Shipment"/>
        <relationship type="one" related="mantle.party.contact.ContactMechPurpose"/>
        <relationship type="one" related="mantle.party.contact.ContactMech"/>
    </entity>
    <entity entity-name="ShipmentContent" package="mantle.shipment" cache="never">
        <field name="shipmentContentId" type="id" is-pk="true"/>
        <field name="shipmentContentTypeEnumId" type="id"/>
        <field name="shipmentId" type="id"/>
        <field name="productId" type="id"/>
        <field name="shipmentPackageSeqId" type="id"/>
        <field name="shipmentRouteSegmentSeqId" type="id"/>
        <field name="contentLocation" type="text-medium"/>
        <field name="description" type="text-long"/>
        <field name="contentDate" type="date-time" default="ec.user.nowTimestamp"/>
        <field name="userId" type="id" default="ec.user.userId"/>
        <relationship type="one" title="ShipmentContentType" related="moqui.basic.Enumeration">
            <key-map field-name="shipmentContentTypeEnumId"/></relationship>
        <relationship type="one" related="mantle.shipment.Shipment"/>
        <relationship type="one" related="mantle.product.Product"/>
        <relationship type="one-nofk" related="mantle.shipment.ShipmentPackage">
            <key-map field-name="shipmentId"/><key-map field-name="shipmentPackageSeqId"/></relationship>
        <relationship type="one-nofk" related="mantle.shipment.ShipmentRouteSegment">
            <key-map field-name="shipmentId"/><key-map field-name="shipmentRouteSegmentSeqId"/></relationship>
        <relationship type="one" related="moqui.security.UserAccount"/>
    </entity>
    <entity entity-name="ShipmentEmailMessage" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="emailMessageId" type="id" is-pk="true"/>
        <relationship type="one" related="mantle.shipment.Shipment"/>
        <relationship type="one" related="moqui.basic.email.EmailMessage"/>
    </entity>
    <entity entity-name="ShipmentItem" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="productId" type="id" is-pk="true"/>
        <field name="quantity" type="number-decimal"/>
        <relationship type="one" related="mantle.shipment.Shipment"/>
        <relationship type="one" related="mantle.product.Product"/>
        <relationship type="many" related="mantle.shipment.ShipmentItemSource" short-alias="sources">
            <key-map field-name="shipmentId"/><key-map field-name="productId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentPackageContent" short-alias="contents">
            <key-map field-name="shipmentId"/><key-map field-name="productId"/></relationship>
        <relationship type="many" related="mantle.product.issuance.AssetIssuance" short-alias="issuances">
            <key-map field-name="shipmentId"/><key-map field-name="productId"/></relationship>
        <relationship type="many" related="mantle.product.receipt.AssetReceipt" short-alias="receipts">
            <key-map field-name="shipmentId"/><key-map field-name="productId"/></relationship>
    </entity>
    <entity entity-name="ShipmentItemSource" package="mantle.shipment" cache="never">
        <field name="shipmentItemSourceId" type="id" is-pk="true"/>
        <field name="shipmentId" type="id" not-null="true"/>
        <field name="productId" type="id" not-null="true"/>
        <field name="binLocationNumber" type="number-integer">
            <description>This overrides the corresponding Shipment.binLocationNumber so that a shipment may be split
                across picklist bins, such as when one bin per order on the shipment is needed.</description>
        </field>
        <field name="orderId" type="id"/>
        <field name="orderItemSeqId" type="id"/>
        <field name="returnId" type="id"/>
        <field name="returnItemSeqId" type="id"/>
        <field name="statusId" type="id"/>
        <field name="quantity" type="number-decimal"/>
        <field name="quantityNotHandled" type="number-decimal"/>
        <field name="invoiceId" type="id"/>
        <field name="invoiceItemSeqId" type="id"/>
        <relationship type="one-nofk" related="mantle.shipment.Shipment" short-alias="shipment"/>
        <relationship type="one" related="mantle.shipment.ShipmentItem" short-alias="item"/>
        <relationship type="one" related="mantle.product.Product" short-alias="product"/>
        <relationship type="one-nofk" related="mantle.order.OrderHeader" short-alias="orderHeader"/>
        <relationship type="one" related="mantle.order.OrderItem" short-alias="orderItem"/>
        <relationship type="one" related="mantle.order.return.ReturnHeader" short-alias="returnHeader"/>
        <relationship type="one" title="ShipmentItemSource" related="moqui.basic.StatusItem" short-alias="status"/>
        <relationship type="one" related="mantle.account.invoice.InvoiceItem" short-alias="invoiceItem">
            <key-map field-name="invoiceId"/><key-map field-name="invoiceItemSeqId"/></relationship>
        <index name="SHIP_ITSRC_SHIPID"><index-field name="shipmentId"/></index>
        <seed-data>
            <!-- Shipment Item Pick Status -->
            <moqui.basic.StatusType description="Shipment Item Pick Status" statusTypeId="ShipmentItemSource"/>
            <moqui.basic.StatusItem description="Pending" sequenceNum="1" statusId="SisPending" statusTypeId="ShipmentItemSource"/>
            <moqui.basic.StatusItem description="Picked" sequenceNum="5" statusId="SisPicked" statusTypeId="ShipmentItemSource"/>
            <moqui.basic.StatusItem description="Packed" sequenceNum="9" statusId="SisPacked" statusTypeId="ShipmentItemSource"/>
            <moqui.basic.StatusItem description="Received" sequenceNum="20" statusId="SisReceived" statusTypeId="ShipmentItemSource"/>
            <moqui.basic.StatusItem description="Cancelled" sequenceNum="99" statusId="SisCancelled" statusTypeId="ShipmentItemSource"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPending" toStatusId="SisPicked" transitionName="Pick"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPending" toStatusId="SisPacked" transitionName="Pack"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPicked" toStatusId="SisPacked" transitionName="Pack"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPending" toStatusId="SisReceived" transitionName="Receive"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPicked" toStatusId="SisReceived" transitionName="Receive"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPacked" toStatusId="SisReceived" transitionName="Receive"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPacked" toStatusId="SisPending" transitionName="Unpack"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="SisPending" toStatusId="SisCancelled" transitionName="Cancel"/>
        </seed-data>
    </entity>
    <entity entity-name="ShipmentPackage" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="shipmentPackageSeqId" type="id" is-pk="true"/>
        <field name="shipmentBoxTypeId" type="id" enable-audit-log="update"/>
        <field name="weight" type="number-decimal" enable-audit-log="update"/>
        <field name="weightUomId" type="id" enable-audit-log="update"/>
        <field name="gatewayPackageId" type="text-medium"/>
        <relationship type="one" related="mantle.shipment.Shipment" short-alias="shipment"/>
        <relationship type="one" related="mantle.shipment.ShipmentBoxType" short-alias="boxType"/>
        <relationship type="one" title="Weight" related="moqui.basic.Uom" short-alias="weightUom">
            <key-map field-name="weightUomId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentPackageContent" short-alias="contents">
            <key-map field-name="shipmentId"/><key-map field-name="shipmentPackageSeqId"/></relationship>
        <relationship type="many" related="mantle.shipment.ShipmentPackageRouteSeg" short-alias="routeSegments">
            <key-map field-name="shipmentId"/><key-map field-name="shipmentPackageSeqId"/></relationship>
    </entity>
    <entity entity-name="ShipmentPackageContent" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="shipmentPackageSeqId" type="id" is-pk="true"/>
        <field name="productId" type="id" is-pk="true"/>
        <field name="quantity" type="number-decimal"/>
        <relationship type="one-nofk" related="mantle.shipment.Shipment" short-alias="shipment"/>
        <relationship type="one" related="mantle.shipment.ShipmentPackage" short-alias="package">
            <key-map field-name="shipmentId"/><key-map field-name="shipmentPackageSeqId"/></relationship>
        <relationship type="one" related="mantle.shipment.ShipmentItem" short-alias="item">
            <key-map field-name="shipmentId"/><key-map field-name="productId"/></relationship>
        <relationship type="one-nofk" related="mantle.product.Product" short-alias="product"/>
    </entity>
    <entity entity-name="ShipmentPackageRouteSeg" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="shipmentPackageSeqId" type="id" is-pk="true"/>
        <field name="shipmentRouteSegmentSeqId" type="id" is-pk="true"/>
        <field name="trackingCode" type="text-medium" enable-audit-log="update"/>
        <field name="trackingUrl" type="text-long"/>
        <field name="trackingStatusEnumId" type="id" enable-audit-log="true"/>
        <field name="trackingSubStatus" type="text-short" enable-audit-log="update"/>
        <field name="trackingStatusDate" type="date-time"/>
        <field name="trackingEta" type="date-time"/>
        <field name="trackingOrigEta" type="date-time"/>
        <field name="boxNumber" type="text-short"/>

        <field name="gatewayStatus" type="text-short" enable-audit-log="update"/>
        <field name="gatewayMessage" type="text-medium"/>
        <field name="gatewayLabelId" type="text-medium" enable-audit-log="update"/>
        <field name="gatewayRateId" type="text-medium" enable-audit-log="update"/>
        <field name="gatewayRefundId" type="text-medium" enable-audit-log="update"/>
        <field name="gatewayRefundStatus" type="text-short" enable-audit-log="update"/>

        <field name="labelDate" type="date-time"/>
        <field name="labelUrl" type="text-long"/>
        <field name="labelImage" type="binary-very-long"/>
        <field name="labelIntlSignImage" type="binary-very-long"/>
        <field name="labelHtml" type="text-very-long"/>
        <field name="labelPrinted" type="text-indicator"/>
        <field name="internationalInvoice" type="binary-very-long"/>

        <field name="returnTrackingCode" type="text-medium" enable-audit-log="update"/>
        <field name="returnTrackingUrl" type="text-long"/>
        <field name="returnTrackingStatusEnumId" type="id" enable-audit-log="update"/>
        <field name="returnTrackingSubStatus" type="text-short" enable-audit-log="update"/>
        <field name="returnTrackingStatusDate" type="date-time"/>
        <field name="returnLabelDate" type="date-time"/>
        <field name="returnLabelUrl" type="text-long"/>
        <field name="returnLabelImage" type="binary-very-long"/>
        <field name="returnGatewayStatus" type="text-short" enable-audit-log="update"/>
        <field name="returnGatewayMessage" type="text-medium"/>
        <field name="returnGatewayLabelId" type="text-medium" enable-audit-log="update"/>
        <field name="returnGatewayRateId" type="text-medium" enable-audit-log="update"/>
        <field name="returnEstimatedAmount" type="currency-amount"/>

        <field name="estimatedAmount" type="currency-amount"/>
        <field name="packageTransportAmount" type="currency-amount"/>
        <field name="packageServiceAmount" type="currency-amount"/>
        <field name="packageOtherAmount" type="currency-amount"/>
        <field name="codAmount" type="currency-amount"/>
        <field name="insuredAmount" type="currency-amount"/>
        <!-- should use costUomId on ShipmentRouteSegment or Shipment: <field name="amountUomId" type="id"/> -->
        <relationship type="one-nofk" related="mantle.shipment.Shipment" short-alias="shipment"/>
        <relationship type="one" related="mantle.shipment.ShipmentPackage" short-alias="package">
            <key-map field-name="shipmentId"/><key-map field-name="shipmentPackageSeqId"/></relationship>
        <relationship type="one" related="mantle.shipment.ShipmentRouteSegment" short-alias="routeSegment">
            <key-map field-name="shipmentId"/><key-map field-name="shipmentRouteSegmentSeqId"/></relationship>
        <relationship type="one" title="ShipmentTrackingStatus" related="moqui.basic.Enumeration" short-alias="trackingStatusEnum">
            <key-map field-name="trackingStatusEnumId"/></relationship>
        <relationship type="one" title="ReturnTrackingStatus" related="moqui.basic.Enumeration" short-alias="returnTrackingStatusEnum">
            <key-map field-name="returnTrackingStatusEnumId"/></relationship>
        <index name="SHIP_PKRTSG_SHIPID"><index-field name="shipmentId"/></index>
        <index name="SHIP_PKRTSG_TRKCODE"><index-field name="trackingCode"/></index>
        <index name="SHIP_PKRTSG_GTLBL"><index-field name="gatewayLabelId"/></index>
        <index name="SHIP_PKRTSG_RTTRKCD"><index-field name="returnTrackingCode"/></index>
        <index name="SHIP_PKRTSG_RTGTLBL"><index-field name="returnGatewayLabelId"/></index>
        <seed-data>
            <moqui.basic.EnumerationType description="Shipping Tracking Status" enumTypeId="ShipmentTrackingStatus"/>
            <moqui.basic.Enumeration description="Unknown" enumId="ShTsUnknown" enumTypeId="ShipmentTrackingStatus"/>
            <moqui.basic.Enumeration description="In Transit" enumId="ShTsTransit" enumTypeId="ShipmentTrackingStatus"/>
            <moqui.basic.Enumeration description="Delivered" enumId="ShTsDelivered" enumTypeId="ShipmentTrackingStatus"/>
            <moqui.basic.Enumeration description="Returned" enumId="ShTsReturned" enumTypeId="ShipmentTrackingStatus"/>
            <moqui.basic.Enumeration description="Failure" enumId="ShTsFailure" enumTypeId="ShipmentTrackingStatus"/>
        </seed-data>
    </entity>
    <entity entity-name="ShipmentRouteSegment" package="mantle.shipment" cache="never">
        <field name="shipmentId" type="id" is-pk="true"/>
        <field name="shipmentRouteSegmentSeqId" type="id" is-pk="true"/>
        <field name="deliveryId" type="id"/>
        <field name="shippingGatewayConfigId" type="id"/>

        <field name="originFacilityId" type="id"/>
        <field name="originPostalContactMechId" type="id"/>
        <field name="originTelecomContactMechId" type="id"/>
        <field name="returnPostalContactMechId" type="id"/>
        <field name="destinationFacilityId" type="id"/>
        <field name="destPostalContactMechId" type="id" enable-audit-log="update"/>
        <field name="destTelecomContactMechId" type="id"/>

        <field name="carrierPartyId" type="id" enable-audit-log="update"/>
        <field name="shipmentMethodEnumId" type="id" enable-audit-log="update"/>
        <field name="statusId" type="id" enable-audit-log="true"/>
        <field name="carrierDeliveryZone" type="text-short"/>
        <field name="carrierRestrictionCodes" type="text-short"/>
        <field name="carrierRestrictionDesc" type="text-very-long"/>

        <field name="billingWeight" type="number-decimal"/>
        <field name="billingWeightUomId" type="id"/>

        <field name="actualTransportCost" type="currency-amount"/>
        <field name="actualServiceCost" type="currency-amount"/>
        <field name="actualOtherCost" type="currency-amount"/>
        <field name="actualCost" type="currency-amount"/>
        <field name="costUomId" type="id"/>

        <field name="actualStartDate" type="date-time"/>
        <field name="actualArrivalDate" type="date-time"/>
        <field name="estimatedStartDate" type="date-time"/>
        <field name="estimatedArrivalDate" type="date-time"/>

        <field name="masterTrackingCode" type="text-medium" enable-audit-log="update"/>
        <field name="masterTrackingUrl" type="text-long"/>

        <field name="homeDeliveryType" type="id"/>
        <field name="homeDeliveryDate" type="date-time"/>

        <field name="thirdPartyAccountNumber" type="id"/>
        <field name="thirdPartyPostalCode" type="id"/>
        <field name="thirdPartyCountryGeoCode" type="id"/>

        <field name="highValueReport" type="binary-very-long"/>

        <relationship type="one" related="mantle.shipment.Shipment"/>
        <relationship type="one" related="mantle.shipment.carrier.Delivery"/>
        <relationship type="one" related="mantle.shipment.carrier.ShippingGatewayConfig"/>
        <relationship type="one" title="Carrier" related="mantle.party.Party" short-alias="carrierParty">
            <key-map field-name="carrierPartyId"/></relationship>
        <relationship type="one" title="ShipmentMethod" related="moqui.basic.Enumeration" short-alias="shipmentMethod">
            <key-map field-name="shipmentMethodEnumId"/></relationship>

        <relationship type="one" title="Origin" related="mantle.facility.Facility" short-alias="originFacility">
            <key-map field-name="originFacilityId"/></relationship>
        <relationship type="one-nofk" title="Origin" related="mantle.party.contact.ContactMech" short-alias="originPostal">
            <key-map field-name="originPostalContactMechId"/></relationship>
        <relationship type="one" title="Origin" related="mantle.party.contact.PostalAddress" short-alias="originPostalAddress">
            <key-map field-name="originPostalContactMechId"/></relationship>
        <relationship type="one-nofk" title="Origin" related="mantle.party.contact.ContactMech" short-alias="originTelecom">
            <key-map field-name="originTelecomContactMechId"/></relationship>
        <relationship type="one" title="Origin" related="mantle.party.contact.TelecomNumber">
            <key-map field-name="originTelecomContactMechId"/></relationship>
        <relationship type="one-nofk" title="Return" related="mantle.party.contact.ContactMech" short-alias="returnPostal">
            <key-map field-name="returnPostalContactMechId"/></relationship>
        <relationship type="one" title="Return" related="mantle.party.contact.PostalAddress" short-alias="returnPostalAddress">
            <key-map field-name="returnPostalContactMechId"/></relationship>

        <relationship type="one" title="Destination" related="mantle.facility.Facility" short-alias="destFacility">
            <key-map field-name="destinationFacilityId"/></relationship>
        <relationship type="one-nofk" title="Destination" related="mantle.party.contact.ContactMech" short-alias="destPostal">
            <key-map field-name="destPostalContactMechId"/></relationship>
        <relationship type="one" title="Destination" related="mantle.party.contact.PostalAddress">
            <key-map field-name="destPostalContactMechId"/></relationship>
        <relationship type="one-nofk" title="Destination" related="mantle.party.contact.ContactMech" short-alias="destTelecom">
            <key-map field-name="destTelecomContactMechId"/></relationship>
        <relationship type="one" title="Destination" related="mantle.party.contact.TelecomNumber">
            <key-map field-name="destTelecomContactMechId"/></relationship>
        <relationship type="one" title="ShipmentRouteSegment" related="moqui.basic.StatusItem" short-alias="status"/>
        <relationship type="one" title="Cost" related="moqui.basic.Uom" short-alias="costUom">
            <key-map field-name="costUomId"/></relationship>
        <relationship type="one" title="BillingWeight" related="moqui.basic.Uom" short-alias="billingWeightUom">
            <key-map field-name="billingWeightUomId"/></relationship>
        <seed-data>
            <!-- Shipment Route Segment Status -->
            <moqui.basic.StatusType description="Shipment Route Segment Status" statusTypeId="ShipmentRouteSegment"/>
            <moqui.basic.StatusItem description="Not Started" sequenceNum="1" statusId="ShrssNotStarted" statusTypeId="ShipmentRouteSegment"/>
            <moqui.basic.StatusItem description="Confirmed" sequenceNum="2" statusId="ShrssConfirmed" statusTypeId="ShipmentRouteSegment"/>
            <moqui.basic.StatusItem description="Accepted" sequenceNum="3" statusId="ShrssAccepted" statusTypeId="ShipmentRouteSegment"/>
            <moqui.basic.StatusItem description="Voided" sequenceNum="8" statusId="ShrssVoided" statusTypeId="ShipmentRouteSegment"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShrssNotStarted" toStatusId="ShrssConfirmed" transitionName="Confirm"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShrssConfirmed" toStatusId="ShrssAccepted" transitionName="Accept"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShrssConfirmed" toStatusId="ShrssVoided" transitionName="Void"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="ShrssAccepted" toStatusId="ShrssVoided" transitionName="Void"/>
        </seed-data>
    </entity>

    <!-- ========================================================= -->
    <!-- mantle.shipment.carrier -->
    <!-- ========================================================= -->

    <entity entity-name="CarrierShipmentMethod" package="mantle.shipment.carrier" cache="true">
        <field name="carrierPartyId" type="id" is-pk="true"/>
        <field name="shipmentMethodEnumId" type="id" is-pk="true"/>
        <field name="description" type="text-medium"/>
        <field name="sequenceNum" type="number-integer"/>
        <field name="carrierServiceCode" type="text-short"/>
        <field name="scaCode" type="text-short"><description>Standard Carrier Alpha Code</description></field>
        <field name="gatewayServiceCode" type="text-short"/>
        <relationship type="one" title="Carrier" related="mantle.party.Party" short-alias="carrierParty">
            <key-map field-name="carrierPartyId"/></relationship>
        <relationship type="one" title="ShipmentMethod" related="moqui.basic.Enumeration" short-alias="shipmentMethodEnum">
            <key-map field-name="shipmentMethodEnumId"/></relationship>
        <seed-data>
            <!-- Shipment Method -->
            <moqui.basic.EnumerationType description="Shipment Method" enumTypeId="ShipmentMethod"/>
            <moqui.basic.Enumeration sequenceNum="1" description="Next Day Priority" enumId="ShMthNextDayPri" enumTypeId="ShipmentMethod"/>
            <moqui.basic.Enumeration sequenceNum="2" description="Next Day Standard" enumId="ShMthNextDay" enumTypeId="ShipmentMethod"/>
            <moqui.basic.Enumeration sequenceNum="3" description="Second Day" enumId="ShMthSecondDay" enumTypeId="ShipmentMethod"/>
            <moqui.basic.Enumeration sequenceNum="4" description="Third Day" enumId="ShMthThirdDay" enumTypeId="ShipmentMethod"/>
            <moqui.basic.Enumeration sequenceNum="5" description="Ground Parcel" enumId="ShMthGround" enumTypeId="ShipmentMethod"/>
            <!-- NOTE Ground Parcel and Ground Commercial have same sequenceNum so sort together;
                main reason for Ground Commercial is annoying FedEx: FedEx Ground can't go to residential, FedEx Home Delivery can't go to commercial -->
            <moqui.basic.Enumeration sequenceNum="5" description="Ground Commercial" enumId="ShMthGroundCom" enumTypeId="ShipmentMethod"/>
            <moqui.basic.Enumeration sequenceNum="6" description="Motor (Common Carrier)" enumId="ShMthMotor" enumTypeId="ShipmentMethod"/>
            <moqui.basic.Enumeration sequenceNum="9" description="Customer Pick Up" enumId="ShMthPickUp" enumTypeId="ShipmentMethod"/>

            <mantle.shipment.carrier.CarrierShipmentMethod carrierPartyId="_NA_" shipmentMethodEnumId="ShMthPickUp" sequenceNum="0"/>
            <mantle.shipment.carrier.CarrierShipmentMethod carrierPartyId="_NA_" shipmentMethodEnumId="ShMthGround" sequenceNum="1"/>
            <mantle.shipment.carrier.CarrierShipmentMethod carrierPartyId="_NA_" shipmentMethodEnumId="ShMthNextDay" sequenceNum="2"/>
        </seed-data>
    </entity>
    <entity entity-name="CarrierShipmentBoxType" package="mantle.shipment.carrier" cache="true">
        <field name="carrierPartyId" type="id" is-pk="true"/>
        <field name="shipmentBoxTypeId" type="id" is-pk="true"/>
        <field name="packagingTypeCode" type="id"/>
        <field name="oversizeCode" type="text-short"/>
        <relationship type="one" related="mantle.shipment.ShipmentBoxType"/>
        <relationship type="one" title="Carrier" related="mantle.party.Party">
            <key-map field-name="carrierPartyId"/></relationship>
    </entity>
    <entity entity-name="Delivery" package="mantle.shipment.carrier" cache="never">
        <field name="deliveryId" type="id" is-pk="true"/>
        <field name="originFacilityId" type="id"/>
        <field name="destFacilityId" type="id"/>
        <field name="actualStartDate" type="date-time"/>
        <field name="actualArrivalDate" type="date-time"/>
        <field name="estimatedStartDate" type="date-time"/>
        <field name="estimatedArrivalDate" type="date-time"/>
        <field name="assetId" type="id"/>
        <field name="startMileage" type="number-decimal"/>
        <field name="endMileage" type="number-decimal"/>
        <field name="fuelUsed" type="number-decimal"/>
        <relationship type="one" related="mantle.product.asset.Asset"/>
        <relationship type="one" title="Origin" related="mantle.facility.Facility">
            <key-map field-name="originFacilityId"/></relationship>
        <relationship type="one" title="Dest" related="mantle.facility.Facility">
            <key-map field-name="destFacilityId"/></relationship>
    </entity>
    <entity entity-name="PartyCarrierAccount" package="mantle.shipment.carrier" cache="never">
        <field name="partyId" type="id" is-pk="true"/>
        <field name="carrierPartyId" type="id" is-pk="true"/>
        <field name="fromDate" type="date-time" is-pk="true"/>
        <field name="thruDate" type="date-time"/>
        <field name="accountNumber" type="id"/>
        <relationship type="one" related="mantle.party.Party">
            <key-map field-name="partyId"/></relationship>
        <relationship type="one" title="Carrier" related="mantle.party.Party">
            <key-map field-name="carrierPartyId"/></relationship>
    </entity>
    <entity entity-name="ShippingGatewayConfig" package="mantle.shipment.carrier" cache="true">
        <field name="shippingGatewayConfigId" type="id" is-pk="true"/>
        <field name="shippingGatewayTypeEnumId" type="id"><description>Each shipping gateway integration should define a
            ShippingGatewayType Enumeration record plus an entity with a shared PK (ie PK is shippingGatewayConfigId).</description></field>
        <field name="description" type="text-medium"/>
        <field name="getOrderRateServiceName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.get#OrderShippingRate interface.</description></field>
        <field name="getShippingRatesBulkName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.get#ShippingRatesBulk interface.</description></field>
        <field name="getAutoPackageInfoName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.get#AutoPackageInfo interface.</description></field>
        <field name="getRateServiceName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.get#ShippingRate interface.</description></field>
        <field name="requestLabelsServiceName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.request#ShippingLabels interface.</description></field>
        <field name="refundLabelsServiceName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.refund#ShippingLabels interface.</description></field>
        <field name="trackLabelsServiceName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.track#ShippingLabels interface.</description></field>
        <field name="validateAddressServiceName" type="text-medium"><description>Service implementing
            mantle.shipment.CarrierServices.validate#ShippingPostalAddress interface.</description></field>
        <relationship type="one" title="ShippingGatewayType" related="moqui.basic.Enumeration">
            <key-map field-name="shippingGatewayTypeEnumId"/></relationship>
        <relationship type="many" related="mantle.shipment.carrier.ShippingGatewayCarrier" short-alias="carriers">
            <key-map field-name="shippingGatewayConfigId"/></relationship>
        <relationship type="many" related="mantle.shipment.carrier.ShippingGatewayOption" short-alias="options">
            <key-map field-name="shippingGatewayConfigId"/></relationship>
        <seed-data>
            <!-- Shipping Gateway Type -->
            <moqui.basic.EnumerationType description="Shipping Gateway Type" enumTypeId="ShippingGatewayType"/>
            <moqui.basic.Enumeration description="Local Shipping Gateway" enumId="ShGtwyLocal" enumTypeId="ShippingGatewayType"/>

            <mantle.shipment.carrier.ShippingGatewayConfig shippingGatewayConfigId="NA_LOCAL"
                    shippingGatewayTypeEnumId="ShGtwyLocal" description="Local gateway for order shipping rate"
                    getOrderRateServiceName="mantle.shipment.CarrierServices.get#OrderShippingRateLocal"/>
        </seed-data>
    </entity>
    <entity entity-name="ShippingGatewayCarrier" package="mantle.shipment.carrier" cache="true">
        <field name="shippingGatewayConfigId" type="id" is-pk="true"/>
        <field name="carrierPartyId" type="id" is-pk="true"/>
        <field name="gatewayAccountId" type="text-medium"/>
        <relationship type="one" related="mantle.shipment.carrier.ShippingGatewayConfig"/>
        <relationship type="one" title="Carrier" related="mantle.party.Party">
            <key-map field-name="carrierPartyId"/></relationship>
    </entity>
    <entity entity-name="ShippingGatewayOption" package="mantle.shipment.carrier" cache="true">
        <field name="shippingGatewayConfigId" type="id" is-pk="true"/>
        <field name="optionEnumId" type="id" is-pk="true"/>
        <field name="optionValue" type="text-medium"/>
        <relationship type="one" related="mantle.shipment.carrier.ShippingGatewayConfig"/>
        <relationship type="one" title="ShippingGatewayOption" related="moqui.basic.Enumeration">
            <key-map field-name="optionEnumId"/></relationship>
        <seed-data>
            <moqui.basic.EnumerationType description="Shipping Gateway Option" enumTypeId="ShippingGatewayOption"/>
            <moqui.basic.Enumeration description="API Token" enumId="SgoApiToken" enumTypeId="ShippingGatewayOption"/>
            <moqui.basic.Enumeration description="Label Type" enumId="SgoLabelType" enumTypeId="ShippingGatewayOption"/>
        </seed-data>
    </entity>
</entities>
